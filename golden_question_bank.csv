SNo,Questions,Domain,reference_sql
1,What is GNS4 trend for last 4 months?,Collections,"SELECT
  DATE_TRUNC(BUSINESS_DATE, MONTH) AS month,
  ROUND(SAFE_DIVIDE(
      COUNT(DISTINCT CASE WHEN MOB_ON_INSTL_START_DATE = 4 AND Bounce_Flag = 'Y' THEN AGREEMENTNO END),
      COUNT(DISTINCT CASE WHEN MOB_ON_INSTL_START_DATE = 4 THEN AGREEMENTNO END)
  ) * 100, 2) AS gns4_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE BUSINESS_DATE >= DATE_SUB((SELECT MAX(BUSINESS_DATE) FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`), INTERVAL 4 MONTH) and SOM_NPASTAGEID = 'REGULAR' and SOM_POS > 0
GROUP BY 1
ORDER BY 1 ASC"
2,Give me top 10 dealer names that have the highest NNS3 percentage and cases are more than 30 per dealer? Show the number of cases.,Collections,"SELECT
  t2.SUPPLIERNAME AS dealer_name,
  COUNT(DISTINCT t2.AGREEMENTNO) AS total_cases,
  ROUND(SAFE_DIVIDE(
      COUNT(DISTINCT CASE WHEN t2.NNS3 = 'Y' THEN t2.AGREEMENTNO END),
      COUNT(DISTINCT t2.AGREEMENTNO)
  ) * 100, 2) AS nns3_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2` AS t2
WHERE t2.BUSINESS_DATE = (SELECT MAX(BUSINESS_DATE) FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`)
  AND t2.SOM_NPASTAGEID = 'REGULAR' and t2.SOM_POS > 0
  AND t2.MOB_ON_INSTL_START_DATE = 3
GROUP BY 1
HAVING total_cases > 30
ORDER BY nns3_percentage DESC
LIMIT 10"
3,Show me the top 10 dealers where banking model has highest no hit percentage? application count should be greater than 30 and what is the approval percentage?,Sourcing,"SELECT
  Dealer_Name_Supplier__c AS dealer_name,
  COUNT(*) AS total_applications,
  COUNT(
    CASE
      WHEN NOT (
        FINAL_APPLICANT_SCORECARD_MODEL_BRE LIKE '%_BKH%'
        OR FINAL_APPLICANT_SCORECARD_MODEL_BRE LIKE '%_BKR%'
      )
      THEN 1
    END
  ) AS no_banking_hit_count,
  ROUND(
    SAFE_DIVIDE(
      COUNT(
        CASE
          WHEN NOT (
            FINAL_APPLICANT_SCORECARD_MODEL_BRE LIKE '%_BKH%'
            OR FINAL_APPLICANT_SCORECARD_MODEL_BRE LIKE '%_BKR%'
          )
          THEN 1
        END
      ),
      COUNT(*)
    ) * 100,
    2
  ) AS no_banking_hit_percentage,
  COUNT(CASE WHEN BRE_Sanction_Result__c IN ('ACCEPT', 'Sanction') THEN 1 END) AS approved_count,
  ROUND(
    SAFE_DIVIDE(
      COUNT(CASE WHEN BRE_Sanction_Result__c IN ('ACCEPT', 'Sanction') THEN 1 END),
      COUNT(*)
    ) * 100,
    2
  ) AS approval_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
WHERE
  DATE(LastModifiedDate) >= DATE_SUB(CURRENT_DATE, INTERVAL '3' MONTH)
GROUP BY
  dealer_name
HAVING
  total_applications > 30
ORDER BY
  no_banking_hit_percentage DESC
LIMIT 10"
4,SHow me the bounce rate on 0 dpd for Assam?,Collections,"WITH MaxDate AS (
  SELECT MAX(BUSINESS_DATE) AS dt
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
)
SELECT
  UPPER(t.STATE) AS state,
  COUNT(DISTINCT t.AGREEMENTNO) AS total_0_dpd_accounts,
  COUNT(DISTINCT CASE WHEN t.Bounce_Flag = 'Y' THEN t.AGREEMENTNO END) AS bounced_0_dpd_accounts,
  ROUND(SAFE_DIVIDE(
    COUNT(DISTINCT CASE WHEN t.Bounce_Flag = 'Y' THEN t.AGREEMENTNO END),
    COUNT(DISTINCT t.AGREEMENTNO)
  ) * 100, 2) AS bounce_rate_on_0_dpd_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2` AS t
JOIN MaxDate AS md
  ON t.BUSINESS_DATE = md.dt
WHERE
  UPPER(t.STATE) = 'ASSAM'
  AND t.SOM_DPD = 0
  AND t.SOM_NPASTAGEID = 'REGULAR'
  AND t.SOM_POS > 0
GROUP BY 1
ORDER BY 1"
5,What is the rejection based on CIBIL score below 650 in the last 3 months? Month on month?,Sourcing,"SELECT
  FORMAT_DATE('%Y-%m', DATE_TRUNC(DATE(LastModifiedDate), MONTH)) AS month,
  COUNT(*) AS total_applications_below_650_cibil,
  COUNT(CASE WHEN BRE_Sanction_Result__c IN ('REJECT', 'Reject') THEN 1 END) AS rejected_applications_below_650_cibil,
  ROUND(
    SAFE_DIVIDE(
      COUNT(CASE WHEN BRE_Sanction_Result__c IN ('REJECT', 'Reject') THEN 1 END),
      COUNT(*)
    ) * 100,
    2
  ) AS rejection_rate_pct
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
WHERE
  DATE(LastModifiedDate) >= DATE_SUB(DATE_TRUNC(DATE_SUB(CURRENT_DATE, INTERVAL '1' MONTH), MONTH), INTERVAL '2' MONTH)
  AND DATE(LastModifiedDate) <= LAST_DAY(DATE_SUB(CURRENT_DATE, INTERVAL '1' MONTH))
  AND SAFE_CAST(CIBIL_SCORE AS INT64) < 650
GROUP BY
  1
ORDER BY
  1 DESC"
6,What is the rejection rate for applications where CIBIL score is between 300-650 in October 2025? Also list out the reason of rejections for these cases.,Sourcing,"WITH FilteredApplications AS (
  SELECT
    BRE_Sanction_Result__c,
    SCORECARD_MODEL_DESCRIPTION_BRE__c
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
  WHERE
    DATE(LastModifiedDate) >= '2025-10-01'
    AND DATE(LastModifiedDate) < '2025-11-01'
    AND SAFE_CAST(CIBIL_SCORE AS INT64) BETWEEN 300 AND 650
), OverallSummary AS (
  SELECT
    COUNT(*) AS total_applications_in_cohort,
    COUNT(CASE WHEN BRE_Sanction_Result__c IN ('REJECT', 'Reject') THEN 1 END) AS total_rejected_in_cohort,
    ROUND(
      SAFE_DIVIDE(
        COUNT(CASE WHEN BRE_Sanction_Result__c IN ('REJECT', 'Reject') THEN 1 END),
        COUNT(*)
      ) * 100,
      2
    ) AS overall_rejection_rate_pct
  FROM FilteredApplications
)
SELECT
  1 AS sort_order, /* Used for ordering the result sets */
  'Overall Summary' AS report_section,
  CAST(os.total_applications_in_cohort AS STRING) AS total_applications,
  CAST(os.total_rejected_in_cohort AS STRING) AS rejected_applications,
  CAST(os.overall_rejection_rate_pct AS STRING) AS rejection_rate_pct,
  CAST(NULL AS STRING) AS rejection_reason,
  CAST(NULL AS STRING) AS reason_count
FROM OverallSummary AS os
UNION ALL
SELECT
  2 AS sort_order,
  'Rejection Reason Breakdown' AS report_section,
  CAST(NULL AS STRING) AS total_applications,
  CAST(NULL AS STRING) AS rejected_applications,
  CAST(NULL AS STRING) AS rejection_rate_pct,
  COALESCE(fa.SCORECARD_MODEL_DESCRIPTION_BRE__c, 'Unknown Reason') AS rejection_reason,
  CAST(COUNT(*) AS STRING) AS reason_count
FROM FilteredApplications AS fa
WHERE
  fa.BRE_Sanction_Result__c IN ('REJECT', 'Reject')
GROUP BY
  rejection_reason
ORDER BY
  sort_order ASC,
  reason_count DESC"
7,what is the current 1-30 delinquency percentage of the portfolio in comparison with last year?,Collections,"WITH DateAnchors AS (
  SELECT
    MAX(BUSINESS_DATE) AS current_max_date,
    DATE_SUB(MAX(BUSINESS_DATE), INTERVAL 1 YEAR) AS last_year_max_date
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
),
CurrentPortfolio AS (
  SELECT
    COUNT(DISTINCT AGREEMENTNO) AS total_active_accounts,
    COUNT(DISTINCT CASE WHEN DPD_BUCKET = 1 THEN AGREEMENTNO END) AS dpd_1_30_accounts
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
  WHERE BUSINESS_DATE = (SELECT current_max_date FROM DateAnchors)
    AND SOM_NPASTAGEID = 'REGULAR'
    AND SOM_POS > 0
),
LastYearPortfolio AS (
  SELECT
    COUNT(DISTINCT AGREEMENTNO) AS total_active_accounts,
    COUNT(DISTINCT CASE WHEN DPD_BUCKET = 1 THEN AGREEMENTNO END) AS dpd_1_30_accounts
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
  WHERE BUSINESS_DATE = (SELECT last_year_max_date FROM DateAnchors)
    AND SOM_NPASTAGEID = 'REGULAR'
    AND SOM_POS > 0
)
SELECT
  ROUND(SAFE_DIVIDE(cp.dpd_1_30_accounts, cp.total_active_accounts) * 100, 2) AS current_1_30_delinquency_percentage,
  ROUND(SAFE_DIVIDE(lyp.dpd_1_30_accounts, lyp.total_active_accounts) * 100, 2) AS last_year_1_30_delinquency_percentage
FROM CurrentPortfolio cp
CROSS JOIN LastYearPortfolio lyp"
8,How many cases who were at 0 delinquency last year and now have slipped to 90+ ?,Collections,"SELECT
  COUNT(DISTINCT AGREEMENTNO) AS cases_slipped_0LY_to_90PLUSCurrent
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE
  BUSINESS_DATE = (
    SELECT
      MAX(BUSINESS_DATE)
    FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
  )
  AND POS > 0
  AND Delinquency_0LY_90PLUSCurrent_SLIPPAGE_Flag = 1"
9,Which state has the highest normalization rate for the current month in DPD BKT 1?,Collections,"WITH MaxBusinessDate AS (
  SELECT
    MAX(BUSINESS_DATE) AS max_date
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
)
SELECT
  STATE,
  COUNT(DISTINCT CASE WHEN DPD_BUCKET = 0 THEN AGREEMENTNO END) AS normalized_accounts_count,
  COUNT(DISTINCT AGREEMENTNO) AS total_dpd_bkt_1_accounts,
  ROUND(
    SAFE_DIVIDE(
      COUNT(DISTINCT CASE WHEN DPD_BUCKET = 0 THEN AGREEMENTNO END),
      COUNT(DISTINCT AGREEMENTNO)
    ) * 100,
    2
  ) AS normalization_rate_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE
  BUSINESS_DATE = (
    SELECT
      max_date
    FROM MaxBusinessDate
  )
  AND SOM_DPD_BUCKET = 1
  AND POS > 0
  AND NPASTAGEID = 'REGULAR'
GROUP BY
  STATE
ORDER BY
  normalization_rate_percentage DESC
LIMIT 10"
10,Which state has the highest roll forward rate for the current month in DPD BKT 2?,Collections,"WITH MaxBusinessDate AS (
  SELECT
    MAX(BUSINESS_DATE) AS max_date
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
)
SELECT
  STATE,
  COUNT(DISTINCT CASE WHEN (
    DPD_BUCKET - SOM_DPD_BUCKET
  ) > 0 THEN AGREEMENTNO END) AS roll_forward_count,
  COUNT(DISTINCT AGREEMENTNO) AS total_bucket_2_accounts,
  ROUND(
    SAFE_DIVIDE(
      COUNT(DISTINCT CASE WHEN (
        DPD_BUCKET - SOM_DPD_BUCKET
      ) > 0 THEN AGREEMENTNO END),
      COUNT(DISTINCT AGREEMENTNO)
    ) * 100,
    2
  ) AS roll_forward_rate
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE
  BUSINESS_DATE = (
    SELECT
      max_date
    FROM MaxBusinessDate
  )
  AND SOM_DPD_BUCKET = 2
  AND NPASTAGEID = 'REGULAR'
  AND POS > 0
GROUP BY
  STATE
ORDER BY
  roll_forward_rate DESC
LIMIT 1"
11,How is the portfolio performing at MOB 3 for 30+ delinquency?,Collections,"SELECT
  DATE_TRUNC(BUSINESS_DATE, MONTH) as disbursal_month,
  -- Direct calculation using pre-defined mart columns
  ROUND(SAFE_DIVIDE(
    SUM(NR_30_PLUS_3MOB), 
    SUM(DR_30_PLUS_3MOB)
  ) * 100, 2) as mob_3_delinquency_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE BUSINESS_DATE = (SELECT MAX(BUSINESS_DATE) FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`)
GROUP BY 1
ORDER BY 1"
12,"Show me the Vintage Curve for 30+ Delinquency for loans disbursed in Jan 2024, Feb 2024, and Mar 2024? At MOB = 3, 6, 9, 12.",Collections,"SELECT
  DATE_TRUNC(DISBURSALDATE, MONTH) as disbursal_month,
  -- MOB 3 Rate
  ROUND(SAFE_DIVIDE(SUM(NR_30_PLUS_3MOB), SUM(DR_30_PLUS_3MOB)) * 100, 2) as mob_3_rate,
  -- MOB 6 Rate
  ROUND(SAFE_DIVIDE(SUM(NR_30_PLUS_6MOB), SUM(DR_30_PLUS_6MOB)) * 100, 2) as mob_6_rate,
  -- MOB 9 Rate
  ROUND(SAFE_DIVIDE(SUM(NR_30_PLUS_9MOB), SUM(DR_30_PLUS_9MOB)) * 100, 2) as mob_9_rate,
  -- MOB 12 Rate
  ROUND(SAFE_DIVIDE(SUM(NR_30_PLUS_12MOB), SUM(DR_30_PLUS_12MOB)) * 100, 2) as mob_12_rate
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE DISBURSALDATE BETWEEN '2024-01-01' AND '2024-03-31'
GROUP BY 1
ORDER BY 1;"
13,Identify customers who have 'slipped' significantly: They were 0 DPD exactly one year ago but are 90+ DPD today?,Collections,"WITH MaxBusinessDate AS (
  SELECT
    MAX(BUSINESS_DATE) AS max_dt
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
)
SELECT
  t.AGREEMENTNO
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2` AS t
JOIN MaxBusinessDate AS m
  ON t.BUSINESS_DATE = m.max_dt
WHERE
  t.Delinquency_0LY_90PLUSCurrent_SLIPPAGE_Flag = 1
LIMIT 10"
14,Analyze the portfolio risk by Ticket Size: Amount Finance and show the 90+ DPD POS % for each? highest first.,Collections,"SELECT
  AMTFIN_BAND,
  COUNT(DISTINCT AGREEMENTNO) as account_count,
  SUM(POS) as total_pos,
  SUM(NR_90_PLUS) as pos_90_plus,
  ROUND(SAFE_DIVIDE(
    SUM(NR_90_PLUS),
    SUM(POS)
  ) * 100, 2) as dpd_90_plus_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE BUSINESS_DATE = (SELECT MAX(BUSINESS_DATE) FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`)
  AND POS > 0
GROUP BY 1
ORDER BY 5 DESC"
15,what is the current 0+ performance for dealer categories?,Collections,"SELECT
  Supplier_Categorization__Credit_Team,
  COUNT(DISTINCT AGREEMENTNO) AS total_accounts,
  COUNT(DISTINCT CASE WHEN DPD > 0 THEN AGREEMENTNO END) AS col_0_plus_dpd_accounts,
  ROUND(
    SAFE_DIVIDE(
      COUNT(DISTINCT CASE WHEN DPD > 0 THEN AGREEMENTNO END),
      COUNT(DISTINCT AGREEMENTNO)
    ) * 100,
    2
  ) AS col_0_plus_dpd_percentage
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
WHERE
  BUSINESS_DATE = (
    SELECT
      MAX(BUSINESS_DATE)
    FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.TW_COLL_MART_HIST_v2`
  )
  AND POS > 0
  AND NPASTAGEID = 'REGULAR'
GROUP BY
  Supplier_Categorization__Credit_Team
ORDER BY
  col_0_plus_dpd_percentage DESC"
16,what are the last 3 months disbursals where datasutram model score is more than 500?,Sourcing,"SELECT
  COUNT(*) AS total_disbursals,
  SUM(DISBURSED_AMOUNT) AS total_disbursed_amount
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
WHERE
  DISBURSALDATE >= DATE_SUB(CURRENT_DATE, INTERVAL '3' MONTH)
  AND NOT DISBURSALDATE IS NULL
  AND SAFE_CAST(Datasutram_score__c AS INT64) > 500 -- Fixed line"
17,what is the percentage of disbursed cases for last 3 months month on month out of total disbursed for final_application_scorecard model category BH_BKNH_PH? ,Sourcing,"WITH MonthlyDisbursals AS (
  SELECT
    DATE_TRUNC(DISBURSALDATE, MONTH) AS disbursal_month,
    COUNT(*) AS monthly_disbursed_count
  FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
  WHERE
    NOT DISBURSALDATE IS NULL
    AND DISBURSALDATE >= DATE_SUB(CURRENT_DATE, INTERVAL '3' MONTH)
    AND FINAL_APPLICANT_SCORECARD_MODEL_BRE = 'BH_BKNH_PH'
  GROUP BY
    1
)
SELECT
  disbursal_month,
  monthly_disbursed_count,
  SUM(monthly_disbursed_count) OVER () AS total_disbursed_for_category_in_3_months,
  ROUND(
    SAFE_DIVIDE(monthly_disbursed_count, SUM(monthly_disbursed_count) OVER ()) * 100,
    2
  ) AS percentage_of_total_disbursed
FROM MonthlyDisbursals
ORDER BY
  disbursal_month"
18,what are the percentage of last 3 months disbursals in S10 category of CRIF Index?,Sourcing,"SELECT
  ROUND(
    SAFE_DIVIDE(COUNT(CASE WHEN Crif_Index__c = 'S10' THEN 1 END), COUNT(*)) * 100,
    2
  ) AS percentage_disbursals_in_s10
FROM `analytics-datapipeline-prod.aiml_cj_nostd_mart.Sourcing_Data_11_Nov_25`
WHERE
  DISBURSALDATE >= DATE_SUB(CURRENT_DATE, INTERVAL '3' MONTH)
  AND NOT DISBURSALDATE IS NULL"